# Asakusa on M<sup>3</sup>BP - Example Batch Application

This project contains an example batch application working with [Asakusa on M<sup>3</sup>BP](https://github.com/asakusafw/asakusafw-m3bp).

## How to build

### Requirements

* Java SE Development Kit >= 1.8
* CMake >= 2.8
* Make
* GCC-C++ = framework required version

### Build with Gradle

You can build exmaple application using the project included Gradle Wrapper.

```
./gradlew clean assemble
```

### Build for other platforms

[Asakusa on M<sup>3</sup>BP](https://github.com/asakusafw/asakusafw-m3bp) is currently tested on Linux x86_64 runtime environment, so you may need cross compile settings depending on your building environment.

You can do the build for other platforms using CMake Tool-Chain File.

```
./gradlew clean assemble -Dm3bp.toolchain=</path/to/cmake-tool-chain-file>
```

## How to run tests

Before you can run batch application tests, you need to install Asakusa Framewrok runtime environment on your machine.

The first you need to set `ASAKUSA_HOME` environment variable to Asakusa Framework install directory path.

```
export ASAKUSA_HOME=$HOME/asakusafw
```

And you can install with `installAsakusafw` gradle task. This installs Asakusa Framework runtime modules to `ASAKUSA_HOME`.

```
./gradlew installAsakusafw
```

Then you can run any tests.

```
./gradlew test
```

## How to deploy

A deployment archive file `build/asakusafw-example-basic-m3bp.tar.gz` is generated by run `./gradlew assemble`.
You can put it on your target machine and extract under `ASAKUSA_HOME` directory.

```
mkdir -p "$ASAKUSA_HOME"
cd "$ASAKUSA_HOME"
tar -xf /path/to/asakusafw-example-basic-m3bp.tar.gz
find "$ASAKUSA_HOME" -name "*.sh" | xargs chmod u+x
```

## How to run application

### Supported platforms

[Asakusa on M<sup>3</sup>BP](https://github.com/asakusafw/asakusafw-m3bp) is currently tested on Linux x86_64 platform.

### Requirements

* Java SE Development Kit >= 1.8
* GNU C++ Library 4.8.5 (libstdc++.so.6)
* GNU C Library 2.17 (libc.so.6)
* Portable Hardware Locality 1.7 (libhwloc.so.5)

### Setting sample data

This example application reads input data form `$HOME/target/testing/direcito` by default.
You can use sample data includes `$ASAKUSA_HOME/example-dataset`.

```
mkdir -p "$HOME/target/testing/directio"
cp -a $ASAKUSA_HOME/example-dataset/* $HOME/target/testing/directio
```

### Running application

Now you can run application by the following command.

```
$ASAKUSA_HOME/yaess/bin/yaess-batch.sh m3bp.example.summarizeSales -A date=2011-04-01
```

Then you should see the output files on `$HOME/target/testing/directio/result` directory.

* `category/result.csv`
* `error/${date}.csv`

## Referred Projects
* [Asakusa on M<sup>3</sup>BP](https://github.com/asakusafw/asakusafw-m3bp)

## Resources
* [Asakusa on M<sup>3</sup>BP Documentation (ja)](http://docs.asakusafw.com/asakusa-on-m3bp/)
